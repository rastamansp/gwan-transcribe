# Cursor Rules - Projeto TypeScript Monorepo

## VisÃ£o Geral do Projeto
Este Ã© um projeto TypeScript monorepo com backend em NestJS e frontend em React, seguindo Clean Architecture, SOLID principles e Use Cases.

**Status Atual**: âœ… **BACKEND COMPLETO** - Testes BDD 100% passando (38/38 cenÃ¡rios)

## Estrutura do Projeto

### OrganizaÃ§Ã£o de Pastas
```
gwan-transcribe/
â”œâ”€â”€ doc/                          # DocumentaÃ§Ã£o do projeto
â”‚   â”œâ”€â”€ project_status.md         # Status de implementaÃ§Ã£o âœ… ATUALIZADO
â”‚   â”œâ”€â”€ tasks.md                  # Detalhamento de tarefas âœ… ATUALIZADO
â”‚   â””â”€â”€ architecture/             # DocumentaÃ§Ã£o de arquitetura
â”œâ”€â”€ backend/                      # AplicaÃ§Ã£o NestJS âœ… COMPLETO
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ modules/             # MÃ³dulos da aplicaÃ§Ã£o
â”‚   â”‚   â”œâ”€â”€ shared/              # CÃ³digo compartilhado
â”‚   â”‚   â”œâ”€â”€ infrastructure/      # Camada de infraestrutura
â”‚   â”‚   â”œâ”€â”€ application/         # Camada de aplicaÃ§Ã£o (Use Cases)
â”‚   â”‚   â””â”€â”€ domain/              # Camada de domÃ­nio
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ frontend/                     # AplicaÃ§Ã£o React â³ PENDENTE
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/          # Componentes React
â”‚   â”‚   â”œâ”€â”€ hooks/               # Custom hooks
â”‚   â”‚   â”œâ”€â”€ services/            # ServiÃ§os de API
â”‚   â”‚   â”œâ”€â”€ types/               # Tipos TypeScript
â”‚   â”‚   â””â”€â”€ utils/               # UtilitÃ¡rios
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ shared/                       # CÃ³digo compartilhado
â”‚   â”œâ”€â”€ types/                   # Tipos compartilhados
â”‚   â””â”€â”€ utils/                   # UtilitÃ¡rios compartilhados
â””â”€â”€ package.json                 # Package.json raiz (workspace)
```

## PadrÃµes de Arquitetura

### Clean Architecture (Backend) âœ… IMPLEMENTADO
- **Domain Layer**: Entidades, Value Objects, Interfaces de repositÃ³rio
- **Application Layer**: Use Cases, DTOs, Interfaces de serviÃ§os
- **Infrastructure Layer**: ImplementaÃ§Ãµes concretas, banco de dados, APIs externas
- **Presentation Layer**: Controllers, Middlewares, Guards

### SOLID Principles âœ… IMPLEMENTADO
- **Single Responsibility**: Cada classe/funÃ§Ã£o tem uma Ãºnica responsabilidade
- **Open/Closed**: Aberto para extensÃ£o, fechado para modificaÃ§Ã£o
- **Liskov Substitution**: Subtipos sÃ£o substituÃ­veis por seus tipos base
- **Interface Segregation**: Interfaces especÃ­ficas ao invÃ©s de interfaces grandes
- **Dependency Inversion**: Depender de abstraÃ§Ãµes, nÃ£o de implementaÃ§Ãµes

### Use Cases Pattern âœ… IMPLEMENTADO
- Cada funcionalidade de negÃ³cio tem um Use Case dedicado
- Use Cases sÃ£o independentes de frameworks
- Input/Output atravÃ©s de DTOs bem definidos

## ConvenÃ§Ãµes de CÃ³digo

### TypeScript
- Sempre usar tipos explÃ­citos
- Preferir interfaces sobre types quando possÃ­vel
- Usar enums para valores constantes
- Implementar strict mode no tsconfig.json

### Nomenclatura
- **Classes**: PascalCase (ex: UserService)
- **Interfaces**: PascalCase com prefixo I (ex: IUserRepository)
- **FunÃ§Ãµes/VariÃ¡veis**: camelCase (ex: getUserById)
- **Constantes**: UPPER_SNAKE_CASE (ex: API_BASE_URL)
- **Arquivos**: kebab-case (ex: user-service.ts)

### Estrutura de Arquivos
- Um arquivo por classe/interface
- Agrupar arquivos relacionados em pastas
- Usar index.ts para exports
- Manter arquivos com mÃ¡ximo 200-300 linhas

## Backend (NestJS) âœ… COMPLETO

### Estrutura de MÃ³dulos
```
src/modules/user/
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entities/
â”‚   â”œâ”€â”€ value-objects/
â”‚   â””â”€â”€ repositories/
â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ use-cases/
â”‚   â”œâ”€â”€ dto/
â”‚   â””â”€â”€ interfaces/
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ repositories/
â”‚   â”œâ”€â”€ controllers/
â”‚   â””â”€â”€ services/
â””â”€â”€ user.module.ts
```

### PadrÃµes de ImplementaÃ§Ã£o âœ… IMPLEMENTADO
- Usar decorators do NestJS (@Injectable, @Controller, etc.)
- Implementar injeÃ§Ã£o de dependÃªncia
- Usar DTOs para validaÃ§Ã£o de entrada
- Implementar interceptors para logging/erro
- Usar guards para autenticaÃ§Ã£o/autorizaÃ§Ã£o

### Use Cases âœ… IMPLEMENTADO
- Cada Use Case tem um mÃ©todo `execute()`
- Input/Output atravÃ©s de DTOs
- NÃ£o depender de frameworks externos
- Implementar tratamento de erros

## Frontend (React) â³ PENDENTE

### Estrutura de Componentes
- Componentes funcionais com hooks
- Custom hooks para lÃ³gica reutilizÃ¡vel
- Context API para estado global
- Props tipadas com interfaces

### PadrÃµes de Estado
- useState para estado local
- useContext para estado compartilhado
- useReducer para estado complexo
- Evitar prop drilling

### ServiÃ§os de API
- Axios para requisiÃ§Ãµes HTTP
- Interceptors para headers/tokens
- Tipagem forte para responses
- Error handling centralizado

## DocumentaÃ§Ã£o âœ… ATUALIZADA

### Pasta /doc
- **project_status.md**: Status atual de implementaÃ§Ã£o âœ… ATUALIZADO
- **tasks.md**: Lista detalhada de tarefas com status âœ… ATUALIZADO
- **prd.md**: Product Requirements Document (requisitos do produto)
- **architecture/**: DocumentaÃ§Ã£o de arquitetura
- **api/**: DocumentaÃ§Ã£o de APIs
- **deployment/**: Guias de deploy

### README.md
- Deve apontar para documentaÃ§Ã£o em /doc
- Incluir links para project_status.md e tasks.md
- Guia rÃ¡pido de setup
- Links para documentaÃ§Ã£o de arquitetura

### AtualizaÃ§Ã£o ObrigatÃ³ria
- **project_status.md** deve ser mantido sempre atualizado com o status real de implementaÃ§Ã£o âœ… ATUALIZADO
- **tasks.md** deve ser atualizado conforme tarefas sÃ£o executadas âœ… ATUALIZADO
- **prd.md** deve ser respeitado como fonte da verdade para requisitos do produto
- Qualquer mudanÃ§a nos requisitos deve ser refletida no prd.md primeiro

## Boas PrÃ¡ticas âœ… IMPLEMENTADAS

### CÃ³digo
- Evitar duplicaÃ§Ã£o de cÃ³digo
- **IMPORTANTE**: Usar biblioteca de logging estruturado (Winston) ao invÃ©s de console.log âœ… IMPLEMENTADO
- Implementar logging estruturado âœ… IMPLEMENTADO
- Usar environment variables âœ… IMPLEMENTADO
- Implementar error handling robusto âœ… IMPLEMENTADO
- Seguir princÃ­pios de seguranÃ§a âœ… IMPLEMENTADO

### Performance
- Lazy loading de mÃ³dulos
- Code splitting no frontend
- Caching estratÃ©gico
- OtimizaÃ§Ã£o de queries

### Manutenibilidade
- CÃ³digo auto-documentado
- ComentÃ¡rios apenas quando necessÃ¡rio
- RefatoraÃ§Ã£o contÃ­nua
- RevisÃ£o de cÃ³digo

## ConfiguraÃ§Ãµes âœ… IMPLEMENTADAS

### TypeScript
- Strict mode habilitado âœ…
- NoImplicitAny: true âœ…
- StrictNullChecks: true âœ…
- Path mapping para imports âœ…

### ESLint/Prettier
- ConfiguraÃ§Ã£o consistente âœ…
- Auto-format no save âœ…
- Regras especÃ­ficas para React/TypeScript âœ…

### Git
- Conventional commits
- Branch naming: feature/, bugfix/, hotfix/
- Pull request reviews obrigatÃ³rios

## Desenvolvimento

### Workflow
1. Criar branch a partir de main
2. Implementar feature/fix
3. Commits atÃ´micos e descritivos
4. Pull request com descriÃ§Ã£o clara
5. Code review obrigatÃ³rio
6. Merge apÃ³s aprovaÃ§Ã£o

### Debugging
- Logs estruturados âœ… IMPLEMENTADO
- Error boundaries no frontend
- Debug mode configurÃ¡vel
- Stack traces detalhados

## Deploy e Infraestrutura

### Ambientes
- Development (Docker Compose)
- Production (Portainer/Docker Swarm)

### ConfiguraÃ§Ã£o
- Environment variables por ambiente
- Secrets management
- Health checks
- Monitoring e alerting
- ContainerizaÃ§Ã£o com Docker
- OrquestraÃ§Ã£o com Portainer

### URLs de ProduÃ§Ã£o
- **API**: api.transcribe.gwan.br
- **Frontend**: transcribe.gwan.br
- **Portainer**: Servidor Portainer

### Sistema de Filas
- **RabbitMQ** para processamento assÃ­ncrono
- Filas para transcriÃ§Ã£o de Ã¡udio
- Filas para envio de emails
- Workers para processamento em background

## Regras EspecÃ­ficas

### NÃ£o Criar
- Testes unitÃ¡rios (conforme especificaÃ§Ã£o)
- CÃ³digo duplicado
- Arquivos muito longos (>300 linhas)
- DependÃªncias desnecessÃ¡rias

### Sempre Implementar
- Error handling âœ… IMPLEMENTADO
- Logging âœ… IMPLEMENTADO
- ValidaÃ§Ã£o de entrada âœ… IMPLEMENTADO
- Tipagem forte âœ… IMPLEMENTADO
- DocumentaÃ§Ã£o de APIs âœ… IMPLEMENTADO
- AtualizaÃ§Ã£o do project_status.md apÃ³s mudanÃ§as âœ… ATUALIZADO
- AtualizaÃ§Ã£o do tasks.md conforme execuÃ§Ã£o âœ… ATUALIZADO
- Respeito aos requisitos definidos no prd.md

## Testes BDD com Cucumber âœ… COMPLETO

### Estrutura de Testes
```
backend/
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ bdd/
â”‚   â”‚   â”œâ”€â”€ features/           # Arquivos .feature âœ… 2 arquivos
â”‚   â”‚   â”œâ”€â”€ steps/              # Step definitions âœ… 3 arquivos
â”‚   â”‚   â”œâ”€â”€ support/            # Hooks e configuraÃ§Ãµes âœ… 1 arquivo
â”‚   â”‚   â””â”€â”€ world/              # World object e helpers âœ… 1 arquivo
â”‚   â””â”€â”€ cucumber.js             # ConfiguraÃ§Ã£o do Cucumber âœ…
```

### PadrÃµes de Teste âœ… IMPLEMENTADO
- **Features**: Descrever cenÃ¡rios em linguagem natural âœ… 38 cenÃ¡rios
- **Step Definitions**: Implementar em TypeScript âœ… 3 arquivos
- **World Object**: Compartilhar estado entre steps âœ… CustomWorld
- **HTTP Client**: Axios para requisiÃ§Ãµes HTTP âœ…
- **Assertions**: Chai para validaÃ§Ãµes âœ…

### Comandos de Teste âœ… FUNCIONANDO
```bash
# Executar todos os testes BDD âœ… 38/38 passando
pnpm run test:bdd

# Executar testes especÃ­ficos âœ…
pnpm run test:bdd -- --grep "autenticaÃ§Ã£o"

# Gerar relatÃ³rio HTML âœ…
pnpm run test:bdd:report

# Restaurar usuÃ¡rio de teste automaticamente âœ…
# Executado automaticamente apÃ³s cada teste
```

### RestauraÃ§Ã£o AutomÃ¡tica âœ… IMPLEMENTADO
- **Estado padrÃ£o**: `{"name": "Pedro Almeida", "email": "pedro.almeida@gmail.com"}`
- **ExecuÃ§Ã£o**: AutomÃ¡tica ao final dos testes BDD âœ…
- **Token**: `test-token-pedro-almeida` âœ…
- **Logs**: ConfirmaÃ§Ã£o no console âœ…

## PowerShell Commands âœ… ATUALIZADO

### Comandos Corretos
```powershell
# Executar comandos um a um (nÃ£o usar &&)
pnpm run dev; Start-Sleep 5; Invoke-WebRequest -Uri "http://localhost:3000/api/v1/health"

# Testar APIs
Invoke-WebRequest -Uri "http://localhost:3000/api/v1/auth/request-otp" -Method POST -Headers @{"Content-Type"="application/json"} -Body '{"email":"test@example.com","name":"Test User"}'

# Verificar processos
Get-Process -Name "node" | Stop-Process -Force

# Criar diretÃ³rios
New-Item -ItemType Directory -Path "backend/tests/bdd" -Force
```

### VariÃ¡veis de Teste âœ… CONFIGURADAS
```powershell
$baseUrl = "http://localhost:3000/api/v1"
$testToken = "test-token-pedro-almeida"
```

## Logging âœ… OTIMIZADO

### ConfiguraÃ§Ãµes Implementadas
- **Winston**: Logging estruturado âœ…
- **Logs Limpos**: Queries SQL removidas âœ…
- **Performance**: Otimizada âœ…
- **Contexto**: Cada log tem contexto especÃ­fico âœ…

### Exemplo de Log
```
2025-08-05T01:15:28.460Z [UserController] info: AtivaÃ§Ã£o de conta solicitada para usuÃ¡rio: d893cff7-caee-4d4a-a008-9001fb471ab1
```

## Status Atual do Projeto âœ… ATUALIZADO

### âœ… ConcluÃ­do
- **Backend NestJS**: 100% funcional
- **Testes BDD**: 38/38 cenÃ¡rios passando
- **Logging**: Estruturado e limpo
- **ValidaÃ§Ãµes**: Robustas e funcionando
- **DocumentaÃ§Ã£o**: Atualizada

### â³ Em Andamento
- **Frontend React**: A ser implementado
- **Docker**: ConfiguraÃ§Ã£o pendente
- **Deploy**: A ser implementado

### ğŸ¯ PrÃ³ximos Passos
1. Implementar Frontend React
2. Configurar Docker
3. Implementar Deploy

---

**Ãšltima atualizaÃ§Ã£o**: 05/08/2025  
**Status**: âœ… **BACKEND PRONTO PARA PRODUÃ‡ÃƒO**